<!DOCTYPE html>
<html>
<head>
    <title>Add Resident</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Flatpickr CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <script>
        document.addEventListener("DOMContentLoaded", function() {
            // Populate villages
            fetch('/villages/')
                .then(response => response.json())
                .then(data => {
                    const villageSelect = document.getElementById('village_id');
                    villageSelect.innerHTML = '<option value="">--Please choose a village--</option>';
                    data.forEach(village => {
                        const option = document.createElement('option');
                        option.value = village.id;
                        option.textContent = village.name;
                        villageSelect.appendChild(option);
                    });
                });

            // Populate qualifications
            fetch('/qualifications/')
                .then(response => response.json())
                .then(data => {
                    // Populate Qualification Type
                    const typeSelect = document.getElementById('qualification_type');
                    typeSelect.innerHTML = '<option value="">--Please choose a type--</option>';
                    if (data.types) {
                        data.types.forEach(type => {
                            const option = document.createElement('option');
                            option.value = type;
                            option.textContent = type;
                            typeSelect.appendChild(option);
                        });
                    }

                    // Populate Qualification Field
                    const fieldSelect = document.getElementById('qualification_field');
                    fieldSelect.innerHTML = '<option value="">--Please choose a field--</option>';
                    if (data.fields) {
                        data.fields.forEach(field => {
                            const option = document.createElement('option');
                            option.value = field;
                            option.textContent = field;
                            fieldSelect.appendChild(option);
                        });
                    }

                    // Populate Qualification Level
                    const levelSelect = document.getElementById('qualification_level');
                    levelSelect.innerHTML = '<option value="">--Please choose a level--</option>';
                    if (data.levels) {
                        data.levels.forEach(level => {
                            const option = document.createElement('option');
                            option.value = level;
                            option.textContent = level;
                            levelSelect.appendChild(option);
                        });
                    }

                    // Function to update Qualification Name based on selected field
                    function updateQualificationNames(selectedField) {
                        const nameSelect = document.getElementById('qualification_name');
                        nameSelect.innerHTML = '<option value="">--Please choose a name--</option>';
                        if (selectedField && data.names[selectedField]) {
                            data.names[selectedField].forEach(name => {
                                const option = document.createElement('option');
                                option.value = name;
                                option.textContent = name;
                                nameSelect.appendChild(option);
                            });
                        }
                    }

                    // Initial population (empty)
                    updateQualificationNames('');

                    // Update Qualification Name when Qualification Field changes
                    fieldSelect.addEventListener('change', function() {
                        updateQualificationNames(this.value);
                    });
                });
        });
    </script>
    <!-- Flatpickr JS -->
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
</head>
<body>
  <div class="container mt-5">
    <h2 class="text-center mb-4">Add New Resident</h2>
    <form action="/residents/form" method="post" class="p-4 rounded shadow bg-white">
      <input type="text" name="full_name" placeholder="Full Name" required class="form-control mb-2">
      <input type="text" name="national_id" placeholder="National ID" required class="form-control mb-2">
      <label for="gender" class="form-label">Gender:</label>
      <select name="gender" id="gender" required class="form-select mb-2">
        <option value="">--Please choose a gender--</option>
        <option value="Male">Male</option>
        <option value="Female">Female</option>
        <option value="Other">Other</option>
      </select>
      <label for="date_of_birth" class="form-label">Date of Birth:</label>
      <input type="text" name="date_of_birth" id="date_of_birth" required class="form-control mb-2">
      <label for="village_id" class="form-label">Village Name:</label>
      <select name="village_id" id="village_id" required class="form-select mb-2"></select>
      <input type="text" name="stand_number" placeholder="Stand Number" required class="form-control mb-2">
      <input type="text" name="contact_number_1" placeholder="Contact Number 1" required class="form-control mb-2">
      <input type="text" name="contact_number_2" placeholder="Contact Number 2 (Optional)" class="form-control mb-2">
      <input type="email" name="email" placeholder="Email (Optional)" class="form-control mb-2">
      <input type="text" name="skills" placeholder="Skills (comma-separated)" class="form-control mb-2">
      <label for="qualification_type" class="form-label">Qualification Type:</label>
      <select name="qualification_type" id="qualification_type" required class="form-select mb-2"></select>
      <label for="qualification_field" class="form-label">Qualification Field:</label>
      <select name="qualification_field" id="qualification_field" required class="form-select mb-2"></select>
      <label for="qualification_level" class="form-label">Qualification Level:</label>
      <select name="qualification_level" id="qualification_level" required class="form-select mb-2"></select>
      <label for="qualification_name" class="form-label">Qualification Name:</label>
      <select name="qualification_name" id="qualification_name" required class="form-select mb-2"></select>
      <button type="submit" class="btn btn-primary w-100 mt-3">Submit</button>
    </form>
  </div>
  <script>
    document.addEventListener("DOMContentLoaded", function() {
      flatpickr("#date_of_birth", {
        dateFormat: "Y-m-d",
        maxDate: "today"
      });
    });
  </script>
</body>
</html>