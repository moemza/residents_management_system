<!DOCTYPE html>
<html>
<head>
    <title>Edit Resident</title>

    <!-- Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- Flatpickr -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
</head>

<body>
<div class="container mt-5">

<h3 class="mb-4 text-center">Edit Resident: {{ resident.first_name }} {{ resident.last_name }}</h3>

<form method="post" action="/edit-resident/{{ resident.id }}">

<!-- ================= PERSONAL DETAILS ================= -->
<div class="card mb-3">
    <div class="card-header">
        Personal Details
    </div>
    <div class="card-body">
        <div class="row g-2 mb-3">
            <div class="col-md-3">
                <label for="first_name" class="form-label">First Name</label>
                <input type="text" name="first_name" id="first_name" class="form-control" value="{{ resident.first_name }}" required>
            </div>
            <div class="col-md-3">
                <label for="last_name" class="form-label">Last Name</label>
                <input type="text" name="last_name" id="last_name" class="form-control" value="{{ resident.last_name }}" required>
            </div>
            <div class="col-md-3">
                <label for="dob" class="form-label">Date of Birth</label>
                <input type="text" name="dob" id="dob" class="form-control" value="{{ resident.dob }}" required placeholder="YYYY-MM-DD">
            </div>
            <div class="col-md-3">
                <label for="gender" class="form-label">Gender</label>
                <select name="gender" id="gender" class="form-select" required>
                    <option value="">Select Gender</option>
                    <option value="Male" {% if resident.gender == 'Male' %}selected{% endif %}>Male</option>
                    <option value="Female" {% if resident.gender == 'Female' %}selected{% endif %}>Female</option>
                    <option value="Other" {% if resident.gender == 'Other' %}selected{% endif %}>Other</option>
                </select>
            </div>
        </div>
        <div class="row g-2 mb-3">
            <div class="col-md-4">
                <label for="village" class="form-label">Village</label>
                <select name="village" id="village" class="form-select" required>
                    <option value="">Select Village</option>
                    {% for village in villages %}
                        <option value="{{ village }}" {% if resident.village == village %}selected{% endif %}>{{ village }}</option>
                    {% endfor %}
                </select>
            </div>
            <div class="col-md-4">
                <label for="cellphone_no" class="form-label">Cellphone No</label>
                <input type="text" name="cellphone_no" id="cellphone_no" class="form-control" value="{{ resident.cellphone_no }}" required>
            </div>
            <div class="col-md-4">
                <label for="cellphone_no2" class="form-label">Cellphone No 2 (optional)</label>
                <input type="text" name="cellphone_no2" id="cellphone_no2" class="form-control" value="{{ resident.cellphone_no2 or '' }}">
            </div>
        </div>
        <div class="row g-2 mb-3">
            <div class="col-md-4">
                <label for="email" class="form-label">Email (optional)</label>
                <input type="email" name="email" id="email" class="form-control" value="{{ resident.email or '' }}">
            </div>
        </div>
    </div>
</div>

<!-- ================= EDUCATION ================= -->
<div class="card mb-4">
    <div class="card-header d-flex justify-content-between">
        <span>Education</span>
        <button type="button" class="btn btn-sm btn-secondary" onclick="addEducation()">+ Add</button>
    </div>
    <div class="card-body" id="education-section">
        {% for qualification in resident.qualifications %}
        <div class="row g-2 mb-3 education-row">
            <div class="col-md-3">
                <input name="education_institution[]" class="form-control" placeholder="Institution" value="{{ qualification.institution or '' }}">
            </div>
            <div class="col-md-3">
                <select name="education_name[]" class="form-select" required>
                    <option value="">Name</option>
                    {% for field, names in qualifications.names.items() %}
                        <optgroup label="{{ field }}">
                            {% for name in names %}
                                <option value="{{ name }}" {% if qualification.name == name %}selected{% endif %}>{{ name }}</option>
                            {% endfor %}
                        </optgroup>
                    {% endfor %}
                </select>
            </div>
            <div class="col-md-2">
                <select name="education_type[]" class="form-select" required>
                    <option value="">Type</option>
                    {% for type in qualifications.types %}
                        <option value="{{ type }}" {% if qualification.type == type %}selected{% endif %}>{{ type }}</option>
                    {% endfor %}
                </select>
            </div>
            <div class="col-md-2">
                <select name="education_level[]" class="form-select" required>
                    <option value="">Level</option>
                    {% for level in qualifications.levels %}
                        <option value="{{ level }}" {% if qualification.level == level %}selected{% endif %}>{{ level }}</option>
                    {% endfor %}
                </select>
            </div>
            <div class="col-md-2 d-flex align-items-center">
                <input name="education_year[]" class="form-control" placeholder="Year" value="{{ qualification.year or '' }}">
                <button type="button" class="btn btn-danger btn-sm ms-2 delete-education-row" onclick="deleteEducationRow(this)">&#10006;</button>
            </div>
        </div>
        {% endfor %}
        <!-- Empty row for adding new education -->
        <div class="row g-2 mb-3 education-row" style="display: none;">
            <div class="col-md-3">
                <input name="education_institution[]" class="form-control" placeholder="Institution">
            </div>
            <div class="col-md-3">
                <select name="education_name[]" class="form-select" required>
                    <option value="">Name</option>
                    {% for field, names in qualifications.names.items() %}
                        <optgroup label="{{ field }}">
                            {% for name in names %}
                                <option value="{{ name }}">{{ name }}</option>
                            {% endfor %}
                        </optgroup>
                    {% endfor %}
                </select>
            </div>
            <div class="col-md-2">
                <select name="education_type[]" class="form-select" required>
                    <option value="">Type</option>
                    {% for type in qualifications.types %}
                        <option value="{{ type }}">{{ type }}</option>
                    {% endfor %}
                </select>
            </div>
            <div class="col-md-2">
                <select name="education_level[]" class="form-select" required>
                    <option value="">Level</option>
                    {% for level in qualifications.levels %}
                        <option value="{{ level }}">{{ level }}</option>
                    {% endfor %}
                </select>
            </div>
            <div class="col-md-2 d-flex align-items-center">
                <input name="education_year[]" class="form-control" placeholder="Year">
                <button type="button" class="btn btn-danger btn-sm ms-2 delete-education-row" onclick="deleteEducationRow(this)">&#10006;</button>
            </div>
        </div>
    </div>
</div>

<!-- ================= EXPERIENCE ================= -->
<div class="card mb-4">
    <div class="card-header d-flex justify-content-between">
        <span>Work Experience</span>
        <button type="button" class="btn btn-sm btn-secondary" onclick="addExperience()">+ Add</button>
    </div>
    <div class="card-body" id="experience-section">
        {% for exp in resident.experiences %}
        <div class="row g-2 mb-3 experience-row">
            <div class="col-md-4">
                <input name="company[]" class="form-control" placeholder="Company" value="{{ exp.company or '' }}">
            </div>
            <div class="col-md-4">
                <input name="position[]" class="form-control" placeholder="Position" value="{{ exp.position or '' }}">
            </div>
            <div class="col-md-3">
                <input name="years[]" class="form-control" placeholder="Years" value="{{ exp.years or '' }}">
            </div>
            <div class="col-md-1 d-flex align-items-center">
                <button type="button" class="btn btn-danger btn-sm delete-experience-row" onclick="deleteExperienceRow(this)">&#10006;</button>
            </div>
        </div>
        {% endfor %}
        <!-- Empty row for adding new experience -->
        <div class="row g-2 mb-3 experience-row" style="display: none;">
            <div class="col-md-4">
                <input name="company[]" class="form-control" placeholder="Company">
            </div>
            <div class="col-md-4">
                <input name="position[]" class="form-control" placeholder="Position">
            </div>
            <div class="col-md-3">
                <input name="years[]" class="form-control" placeholder="Years">
            </div>
            <div class="col-md-1 d-flex align-items-center">
                <button type="button" class="btn btn-danger btn-sm delete-experience-row" onclick="deleteExperienceRow(this)">&#10006;</button>
            </div>
        </div>
    </div>
</div>

<!-- ================= SKILLS ================= -->
<div class="card mb-4">
    <div class="card-header d-flex justify-content-between">
        <span>Skills</span>
        <button type="button" class="btn btn-sm btn-secondary" onclick="addSkill()">+ Add</button>
    </div>
    <div class="card-body" id="skills-section">
        {% for skill in resident.skills %}
        <div class="row g-2 mb-3 skill-row">
            <div class="col-md-10">
                <input name="skills[]" class="form-control" placeholder="Skill" value="{{ skill.name or '' }}">
            </div>
            <div class="col-md-2 d-flex align-items-center">
                <button type="button" class="btn btn-danger btn-sm ms-2 delete-skill-row" onclick="deleteSkillRow(this)">&#10006;</button>
            </div>
        </div>
        {% endfor %}
        <!-- Empty row for adding new skill -->
        <div class="row g-2 mb-3 skill-row" style="display: none;">
            <div class="col-md-10">
                <input name="skills[]" class="form-control" placeholder="Skill">
            </div>
            <div class="col-md-2 d-flex align-items-center">
                <button type="button" class="btn btn-danger btn-sm ms-2 delete-skill-row" onclick="deleteSkillRow(this)">&#10006;</button>
            </div>
        </div>
    </div>
</div>

<button type="submit" class="btn btn-primary w-100">Update Resident</button>
</form>
</div>

<!-- Bootstrap, Flatpickr, etc. -->
<script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
<!-- Your custom JS -->
<script src="/static/add_resident.js"></script>
</body>
</html>